<!-- chat/templates/chat/room.html -->
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <title>Chat Room</title>
    <!-- FontAwesome JS-->
</head>

<body>

  <div class="order-2 order-md-2 col-12 col-md-10 min-height min-page-height py-3">

    <section class="blog-list px-3 py-5 p-md-5">
        <div class="container">
            <h3>Welcome to The Lobby</h3><br />
            <br class="form-group">
                <textarea style="font-size: 18px; font-weight: bold" class="form-control" id="chat-log" cols="100" rows="10"></textarea>
            </br>
                <input id="chat-message-input" style="font-size: 18px" placeholder="Write text here..." type="text" size="100"/>

            </br>
            </br>

            <button type="submit" id="chat-message-submit" value="Send" class="btn btn-primary">Send</button>

            {% comment %} <button type="button" class="btn btn-primary">Save</button> {% endcomment %}
            {% comment %} <input id="room-name-input" type="text" size="100" /><br /> {% endcomment %}



        </div>
    </section>

</div>

            



        </div>
        <footer class="footer text-center py-2 theme-bg-dark">
            <small class="copyright">Designed <i style="color: #fb866a;"></i> by sarthak</small>
        </footer>
    </div>


    <script>
    var roomName = {{ room_name_json }};

    var protocol = '';
    if (window.location.protocol === 'https:') {
        protocol = 'wss:';
    } else {
        protocol = 'ws:';
    }

    var chatSocket = new WebSocket(
        protocol + '//' + window.location.host +
        '/ws/chat/' + roomName + '/');

    chatSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        var message = data['message'];
        document.querySelector('#chat-log').value += ('>> ' + message + '\n');
    };

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    document.querySelector('#chat-message-input').focus();
    document.querySelector('#chat-message-input').onkeyup = function(e) {
        if (e.keyCode === 13) {  // enter, return
            document.querySelector('#chat-message-submit').click();
        }
    };

    document.querySelector('#chat-message-submit').onclick = function(e) {
        var messageInputDom = document.querySelector('#chat-message-input');
        var message = messageInputDom.value;
        chatSocket.send(JSON.stringify({
            'message': message
        }));

        messageInputDom.value = '';
    };
</script>

</body>
</html>
